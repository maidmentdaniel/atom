"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("atom"),e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i="object"==typeof e&&e&&e.Object===Object&&e,s="object"==typeof self&&self&&self.Object===Object&&self,r=i||s||Function("return this")(),n=r.Symbol,o=Object.prototype,a=o.hasOwnProperty,d=o.toString,l=n?n.toStringTag:void 0;var h=function(t){var e=a.call(t,l),i=t[l];try{t[l]=void 0;var s=!0}catch(t){}var r=d.call(t);return s&&(e?t[l]=i:delete t[l]),r},c=Object.prototype.toString;var u=function(t){return c.call(t)},p=n?n.toStringTag:void 0;var g=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":p&&p in Object(t)?h(t):u(t)};var f=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var m,v=function(t){if(!f(t))return!1;var e=g(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},b=r["__core-js_shared__"],y=(m=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"";var w=function(t){return!!y&&y in t},_=Function.prototype.toString;var I=function(t){if(null!=t){try{return _.call(t)}catch(t){}try{return t+""}catch(t){}}return""},L=/^\[object .+?Constructor\]$/,E=Function.prototype,D=Object.prototype,M=E.toString,P=D.hasOwnProperty,C=RegExp("^"+M.call(P).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var j=function(t){return!(!f(t)||w(t))&&(v(t)?C:L).test(I(t))};var A=function(t,e){return null==t?void 0:t[e]};var O=function(t,e){var i=A(t,e);return j(i)?i:void 0},U=O(Object,"create");var S=function(){this.__data__=U?U(null):{},this.size=0};var $=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},N=Object.prototype.hasOwnProperty;var k=function(t){var e=this.__data__;if(U){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return N.call(e,t)?e[t]:void 0},T=Object.prototype.hasOwnProperty;var x=function(t){var e=this.__data__;return U?void 0!==e[t]:T.call(e,t)};var R=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=U&&void 0===e?"__lodash_hash_undefined__":e,this};function F(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}F.prototype.clear=S,F.prototype.delete=$,F.prototype.get=k,F.prototype.has=x,F.prototype.set=R;var B=F;var z=function(){this.__data__=[],this.size=0};var q=function(t,e){return t===e||t!=t&&e!=e};var V=function(t,e){for(var i=t.length;i--;)if(q(t[i][0],e))return i;return-1},G=Array.prototype.splice;var K=function(t){var e=this.__data__,i=V(e,t);return!(i<0)&&(i==e.length-1?e.pop():G.call(e,i,1),--this.size,!0)};var W=function(t){var e=this.__data__,i=V(e,t);return i<0?void 0:e[i][1]};var Y=function(t){return V(this.__data__,t)>-1};var X=function(t,e){var i=this.__data__,s=V(i,t);return s<0?(++this.size,i.push([t,e])):i[s][1]=e,this};function H(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}H.prototype.clear=z,H.prototype.delete=K,H.prototype.get=W,H.prototype.has=Y,H.prototype.set=X;var J=H,Q=O(r,"Map");var Z=function(){this.size=0,this.__data__={hash:new B,map:new(Q||J),string:new B}};var tt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var et=function(t,e){var i=t.__data__;return tt(e)?i["string"==typeof e?"string":"hash"]:i.map};var it=function(t){var e=et(this,t).delete(t);return this.size-=e?1:0,e};var st=function(t){return et(this,t).get(t)};var rt=function(t){return et(this,t).has(t)};var nt=function(t,e){var i=et(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this};function ot(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}ot.prototype.clear=Z,ot.prototype.delete=it,ot.prototype.get=st,ot.prototype.has=rt,ot.prototype.set=nt;var at=ot;var dt=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var lt=function(t){return this.__data__.has(t)};function ht(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new at;++e<i;)this.add(t[e])}ht.prototype.add=ht.prototype.push=dt,ht.prototype.has=lt;var ct=ht;var ut=function(t,e,i,s){for(var r=t.length,n=i+(s?1:-1);s?n--:++n<r;)if(e(t[n],n,t))return n;return-1};var pt=function(t){return t!=t};var gt=function(t,e,i){for(var s=i-1,r=t.length;++s<r;)if(t[s]===e)return s;return-1};var ft=function(t,e,i){return e==e?gt(t,e,i):ut(t,pt,i)};var mt=function(t,e){return!!(null==t?0:t.length)&&ft(t,e,0)>-1};var vt=function(t,e,i){for(var s=-1,r=null==t?0:t.length;++s<r;)if(i(e,t[s]))return!0;return!1};var bt=function(t,e){return t.has(e)},yt=O(r,"Set");var wt=function(){};var _t=function(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i},It=yt&&1/_t(new yt([,-0]))[1]==1/0?function(t){return new yt(t)}:wt;var Lt=function(t,e,i){var s=-1,r=mt,n=t.length,o=!0,a=[],d=a;if(i)o=!1,r=vt;else if(n>=200){var l=e?null:It(t);if(l)return _t(l);o=!1,r=bt,d=new ct}else d=e?[]:a;t:for(;++s<n;){var h=t[s],c=e?e(h):h;if(h=i||0!==h?h:0,o&&c==c){for(var u=d.length;u--;)if(d[u]===c)continue t;e&&d.push(c),a.push(h)}else r(d,c,i)||(d!==a&&d.push(c),a.push(h))}return a};var Et=function(t){return t&&t.length?Lt(t):[]};function Dt(t,e,i){const s=i.map(t=>"  â€¢ "+t);atom.notifications.addWarning("[Linter] "+t,{dismissable:!0,detail:`${e}\n${s.join("\n")}`})}const Mt=new Set(["error","warning","info"]);function Pt(e,i){const s=[];if(Array.isArray(i)){let e=!1,r=!1,n=!1,o=!1,a=!1,d=!1,l=!1,h=!1,c=!1;for(let u=0,{length:p}=i;u<p;++u){const p=i[u],{reference:g}=p;if(!r&&p.icon&&"string"!=typeof p.icon&&(r=!0,s.push("Message.icon must be a string")),o||p.location&&"object"==typeof p.location&&"string"==typeof p.location.file&&"object"==typeof p.location.position&&p.location.position){if(!o){const e=t.Range.fromObject(p.location.position);(Number.isNaN(e.start.row)||Number.isNaN(e.start.column)||Number.isNaN(e.end.row)||Number.isNaN(e.end.column))&&(o=!0,s.push("Message.location.position should not contain NaN coordinates"))}}else o=!0,s.push("Message.location must be valid");if(d||!p.solutions||Array.isArray(p.solutions)||(d=!0,s.push("Message.solutions must be valid")),l||!g||"object"==typeof g&&"string"==typeof g.file&&"object"==typeof g.position&&g.position){if(!l&&g){const e=t.Point.fromObject(g.position);(Number.isNaN(e.row)||Number.isNaN(e.column))&&(l=!0,s.push("Message.reference.position should not contain NaN coordinates"))}}else l=!0,s.push("Message.reference must be valid");n||"string"==typeof p.excerpt||(n=!0,s.push("Message.excerpt must be a string")),a||Mt.has(p.severity)||(a=!0,s.push("Message.severity must be 'error', 'warning' or 'info'")),!e&&p.url&&"string"!=typeof p.url&&(e=!0,s.push("Message.url must be a string")),!h&&p.description&&"function"!=typeof p.description&&"string"!=typeof p.description&&(h=!0,s.push("Message.description must be a function or string")),!c&&p.linterName&&"string"!=typeof p.linterName&&(c=!0,s.push("Message.linterName must be a string"))}}else s.push("Linter Result must be an Array");return!s.length||(Dt("Invalid Linter Result received",`These issues were encountered while processing messages from a linter named '${e}'`,s),!1)}class Ct{constructor(){this.providers=void 0,this.subscriptions=void 0,this.providers=new Set,this.subscriptions=new t.CompositeDisposable}add(t){!this.providers.has(t)&&function(t){const e=[];return t&&"object"==typeof t?("string"!=typeof t.name&&e.push("UI.name must be a string"),"function"!=typeof t.didBeginLinting&&e.push("UI.didBeginLinting must be a function"),"function"!=typeof t.didFinishLinting&&e.push("UI.didFinishLinting must be a function"),"function"!=typeof t.render&&e.push("UI.render must be a function"),"function"!=typeof t.dispose&&e.push("UI.dispose must be a function")):e.push("UI must be an object"),!e.length||(Dt("Invalid UI received",`These issues were encountered while registering the UI named '${t&&t.name?t.name:"Unknown"}'`,e),!1)}(t)&&(this.subscriptions.add(t),this.providers.add(t))}delete(t){this.providers.has(t)&&(t.dispose(),this.providers.delete(t))}getProviders(){return Array.from(this.providers)}render(t){this.providers.forEach((function(e){e.render(t)}))}didBeginLinting(t,e=null){this.providers.forEach((function(i){i.didBeginLinting(t,e)}))}didFinishLinting(t,e=null){this.providers.forEach((function(i){i.didFinishLinting(t,e)}))}dispose(){this.providers.clear(),this.subscriptions.dispose()}}const jt="__$sb_linter_activated",At="__$sb_linter_request_last_received";function Ot(t,e,i){return!(e&&!t.lintsOnChange)&&i.some((function(e){return t.grammarScopes.includes(e)}))}function Ut(t){return Et(t.getCursors().reduce((t,e)=>t.concat(e.getScopeDescriptor().getScopesArray()),["*"]))}let St;function $t(t,e,i){if(!t)return!0;if(i){let e=null;const i=atom.project.getPaths();for(let s=0,{length:r}=i;s<r;++s){const r=i[s];if(0===t.indexOf(r)){e=atom.project.getRepositories()[s];break}}if(e&&e.isPathIgnored(t))return!0}const s="win32"===process.platform?t.replace(/\\/g,"/"):t;return St||(St=require("minimatch")),St(s,e)}function Nt(t){const{reference:e,location:i}=t;t.key=["$LINTER:"+t.linterName,`$LOCATION:${i.file}$${i.position.start.row}$${i.position.start.column}$${i.position.end.row}$${i.position.end.column}`,e?`$REFERENCE:${e.file}$${e.position?`${e.position.row}$${e.position.column}`:""}`:"$REFERENCE:null","$EXCERPT:"+t.excerpt,"$SEVERITY:"+t.severity,t.icon?"$ICON:"+t.icon:"$ICON:null",t.url?"$URL:"+t.url:"$URL:null","string"==typeof t.description?"$DESCRIPTION:"+t.description:"$DESCRIPTION:null"].join("")}function kt(e,i){for(let s=0,{length:r}=i;s<r;++s){const r=i[s],{reference:n}=r;if(Array.isArray(r.location.position)&&(r.location.position=t.Range.fromObject(r.location.position)),n&&Array.isArray(n.position)&&(n.position=t.Point.fromObject(n.position)),r.solutions&&r.solutions.length)for(let e,i=0,s=r.solutions.length;i<s;i++)e=r.solutions[i],Array.isArray(e.position)&&(e.position=t.Range.fromObject(e.position));r.version=2,r.linterName||(r.linterName=e),Nt(r)}}function Tt(t,e){if(void 0===t||void 0===e)return null;if(!e.length)return{oldKept:[],oldRemoved:[],newAdded:t};if(!t.length)return{oldKept:[],oldRemoved:e,newAdded:[]};const i=function(t){const e=new Map;for(let i=0,{length:s}=t;i<s;++i){const s=t[i];e.set(s.key,s)}return e}(e),s=new Set,r=new Map;for(let e=0,n=t.length;e<n;e++){const n=t[e];i.has(n.key)?r.set(n.key,n):s.add(n)}const n=Array.from(i.keys()),o=Array.from(r.keys()),a=n.filter(t=>!o.includes(t)),d=new Set;for(let t=0,e=a.length;t<e;t++)d.add(i.get(a[t]));return{oldKept:Array.from(r.values()),oldRemoved:d?Array.from(d):[],newAdded:Array.from(s)}}function xt(t,e){e.length&&Array.prototype.push.apply(t,e)}class Rt{constructor(e,i){this.indie=void 0,this.scope=void 0,this.emitter=void 0,this.version=void 0,this.messages=void 0,this.subscriptions=void 0,this.indie=e,this.scope="project",this.version=i,this.emitter=new t.Emitter,this.messages=new Map,this.subscriptions=new t.CompositeDisposable,this.subscriptions.add(this.emitter)}get name(){return this.indie.name}getMessages(){const t=[];return this.messages.forEach(e=>{xt(t,e)}),t}clearMessages(){this.subscriptions.disposed||(this.emitter.emit("did-update",[]),this.messages.clear())}setMessages(t,e=null){if("string"!=typeof t||!Array.isArray(e))throw new Error("Invalid Parameters to setMessages()");!this.subscriptions.disposed&&Pt(this.name,e)&&(e.forEach((function(e){if(e.location.file!==t)throw console.debug("[Linter-UI-Default] Expected File",t,"Message",e),new Error("message.location.file does not match the given filePath")})),kt(this.name,e),this.messages.set(t,e),this.emitter.emit("did-update",this.getMessages()))}setAllMessages(t){if(!this.subscriptions.disposed&&(Array.isArray(t)&&!atom.inDevMode()||Pt(this.name,t))){kt(this.name,t),this.messages.clear();for(let e=0,{length:i}=t;e<i;++e){const i=t[e],s=i.location.file;let r=this.messages.get(s);r||this.messages.set(s,r=[]),r.push(i)}this.emitter.emit("did-update",this.getMessages())}}onDidUpdate(t){return this.emitter.on("did-update",t)}onDidDestroy(t){return this.emitter.on("did-destroy",t)}dispose(){this.emitter.emit("did-destroy"),this.subscriptions.dispose(),this.messages.clear()}}class Ft{constructor(){this.emitter=void 0,this.delegates=void 0,this.subscriptions=void 0,this.emitter=new t.Emitter,this.delegates=new Set,this.subscriptions=new t.CompositeDisposable,this.subscriptions.add(this.emitter)}register(t,e){if(!function(t){const e=[];return t&&"object"==typeof t?"string"!=typeof t.name&&e.push("Indie.name must be a string"):e.push("Indie must be an object"),!e.length||(Dt("Invalid Indie received",`These issues were encountered while registering an Indie Linter named '${t&&t.name?t.name:"Unknown"}'`,e),!1)}(t))throw new Error("Error registering Indie Linter");const i=new Rt(t,e);return this.delegates.add(i),i.onDidDestroy(()=>{this.delegates.delete(i)}),i.onDidUpdate(t=>{this.emitter.emit("did-update",{linter:i,messages:t})}),this.emitter.emit("observe",i),i}getProviders(){return Array.from(this.delegates)}observe(t){return this.delegates.forEach(t),this.emitter.on("observe",t)}onDidUpdate(t){return this.emitter.on("did-update",t)}dispose(){for(const t of this.delegates)t.dispose();this.subscriptions.dispose()}}var Bt=function(){return r.Date.now()};var zt=function(t){return null!=t&&"object"==typeof t};var qt=function(t){return"symbol"==typeof t||zt(t)&&"[object Symbol]"==g(t)},Vt=/^\s+|\s+$/g,Gt=/^[-+]0x[0-9a-f]+$/i,Kt=/^0b[01]+$/i,Wt=/^0o[0-7]+$/i,Yt=parseInt;var Xt=function(t){if("number"==typeof t)return t;if(qt(t))return NaN;if(f(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=f(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Vt,"");var i=Kt.test(t);return i||Wt.test(t)?Yt(t.slice(2),i?2:8):Gt.test(t)?NaN:+t},Ht=Math.max,Jt=Math.min;var Qt=function(t,e,i){var s,r,n,o,a,d,l=0,h=!1,c=!1,u=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var i=s,n=r;return s=r=void 0,l=e,o=t.apply(n,i)}function g(t){return l=t,a=setTimeout(v,e),h?p(t):o}function m(t){var i=t-d;return void 0===d||i>=e||i<0||c&&t-l>=n}function v(){var t=Bt();if(m(t))return b(t);a=setTimeout(v,function(t){var i=e-(t-d);return c?Jt(i,n-(t-l)):i}(t))}function b(t){return a=void 0,u&&s?p(t):(s=r=void 0,o)}function y(){var t=Bt(),i=m(t);if(s=arguments,r=this,d=t,i){if(void 0===a)return g(d);if(c)return clearTimeout(a),a=setTimeout(v,e),p(d)}return void 0===a&&(a=setTimeout(v,e)),o}return e=Xt(e)||0,f(i)&&(h=!!i.leading,n=(c="maxWait"in i)?Ht(Xt(i.maxWait)||0,e):n,u="trailing"in i?!!i.trailing:u),y.cancel=function(){void 0!==a&&clearTimeout(a),l=0,s=d=r=a=void 0},y.flush=function(){return void 0===a?o:b(Bt())},y};class Zt{constructor(){this.emitter=void 0,this.messages=void 0,this.messagesMap=void 0,this.subscriptions=void 0,this.debouncedUpdate=void 0,this.emitter=new t.Emitter,this.messages=[],this.messagesMap=new Set,this.subscriptions=new t.CompositeDisposable,this.debouncedUpdate=Qt(this.update,100,{leading:!0}),this.subscriptions.add(this.emitter)}set({messages:t,linter:e,buffer:i}){let s=null;for(const t of this.messagesMap)if(t.buffer===i&&t.linter===e){s=t;break}s?(s.messages=t,s.changed=!0):this.messagesMap.add({messages:t,linter:e,buffer:i,oldMessages:[],changed:!0,deleted:!1}),this.debouncedUpdate()}update(){const t={added:[],removed:[],messages:[]};for(const e of this.messagesMap){if(e.deleted){xt(t.removed,e.oldMessages),this.messagesMap.delete(e);continue}if(!e.changed){xt(t.messages,e.oldMessages);continue}const i=Tt(e.messages,e.oldMessages);if(null!==i){const{oldKept:s,oldRemoved:r,newAdded:n}=i;xt(t.added,n),xt(t.removed,r);const o=n.concat(s);xt(t.messages,o),e.oldMessages=o}}(t.added.length||t.removed.length)&&(this.messages=t.messages,this.emitter.emit("did-update-messages",t))}onDidUpdateMessages(t){return this.emitter.on("did-update-messages",t)}deleteByBuffer(t){for(const e of this.messagesMap)e.buffer===t&&(e.deleted=!0);this.debouncedUpdate()}deleteByLinter(t){for(const e of this.messagesMap)e.linter===t&&(e.deleted=!0);this.debouncedUpdate()}dispose(){this.subscriptions.dispose()}}class te{constructor(){this.emitter=void 0,this.linters=void 0,this.lintOnChange=void 0,this.ignoreVCS=void 0,this.ignoreGlob=void 0,this.lintPreviewTabs=void 0,this.subscriptions=void 0,this.disabledProviders=void 0,this.activeNotifications=void 0,this.emitter=new t.Emitter,this.linters=new Set,this.subscriptions=new t.CompositeDisposable,this.activeNotifications=new Set,this.subscriptions.add(atom.config.observe("linter.lintOnChange",t=>{this.lintOnChange=t})),this.subscriptions.add(atom.config.observe("core.excludeVcsIgnoredPaths",t=>{this.ignoreVCS=t})),this.subscriptions.add(atom.config.observe("linter.ignoreGlob",t=>{this.ignoreGlob=t})),this.subscriptions.add(atom.config.observe("linter.lintPreviewTabs",t=>{this.lintPreviewTabs=t})),this.subscriptions.add(atom.config.observe("linter.disabledProviders",t=>{this.disabledProviders=t})),this.subscriptions.add(this.emitter)}hasLinter(t){return this.linters.has(t)}addLinter(t){(function(t){const e=[];return t&&"object"==typeof t?("string"!=typeof t.name&&e.push("Linter.name must be a string"),("string"!=typeof t.scope||"file"!==t.scope&&"project"!==t.scope)&&e.push("Linter.scope must be either 'file' or 'project'"),"boolean"!=typeof t.lintsOnChange&&e.push("Linter.lintsOnChange must be a boolean"),Array.isArray(t.grammarScopes)||e.push("Linter.grammarScopes must be an Array"),"function"!=typeof t.lint&&e.push("Linter.lint must be a function")):e.push("Linter must be an object"),!e.length||(Dt("Invalid Linter received",`These issues were encountered while registering a Linter named '${t&&t.name?t.name:"Unknown"}'`,e),!1)})(t)&&(t[jt]=!0,void 0===t.__$sb_linter_request_latest&&(t.__$sb_linter_request_latest=0),void 0===t[At]&&(t[At]=0),t.__$sb_linter_version=2,this.linters.add(t))}getProviders(){return Array.from(this.linters)}deleteLinter(t){this.linters.has(t)&&(t[jt]=!1,this.linters.delete(t))}async lint({onChange:t,editor:e}){const i=e.getPath();if(t&&!this.lintOnChange||$t(e.getPath(),this.ignoreGlob,this.ignoreVCS)||!this.lintPreviewTabs&&atom.workspace.getActivePane().getPendingItem()===e)return!1;const s=Ut(e),r=[];for(const n of this.linters){if(!Ot(n,t,s))continue;if(this.disabledProviders.includes(n.name))continue;const o=++n.__$sb_linter_request_latest,a="file"===n.scope?e.getBuffer():null,d="file"===n.scope?i:null;this.emitter.emit("did-begin-linting",{number:o,linter:n,filePath:d}),r.push(new Promise((function(t){t(n.lint(e))})).then(t=>{if(this.emitter.emit("did-finish-linting",{number:o,linter:n,filePath:d}),n[At]>=o||!n[jt]||a&&!a.isAlive())return;if(n[At]=o,a&&!a.isAlive())return;if(null===t)return;let e=!0;!atom.inDevMode()&&Array.isArray(t)||(e=Pt(n.name,t)),e&&(kt(n.name,t),this.emitter.emit("did-update-messages",{messages:t,linter:n,buffer:a}))},t=>{this.emitter.emit("did-finish-linting",{number:o,linter:n,filePath:d}),console.error("[Linter] Error running "+n.name,t);const e="[Linter] Error running "+n.name;if(Array.from(this.activeNotifications).some(t=>t.getOptions().detail===e))return;const i=atom.notifications.addError(e,{detail:"See Console for more info.",dismissable:!0,buttons:[{text:"Open Console",onDidClick:()=>{atom.openDevTools(),i.dismiss()}},{text:"Cancel",onDidClick:()=>{i.dismiss()}}]})}))}return await Promise.all(r),!0}onDidUpdateMessages(t){return this.emitter.on("did-update-messages",t)}onDidBeginLinting(t){return this.emitter.on("did-begin-linting",t)}onDidFinishLinting(t){return this.emitter.on("did-finish-linting",t)}dispose(){this.activeNotifications.forEach(t=>t.dismiss()),this.activeNotifications.clear(),this.linters.clear(),this.subscriptions.dispose()}}class ee{constructor(e){if(this.editor=void 0,this.emitter=void 0,this.subscriptions=void 0,!atom.workspace.isTextEditor(e))throw new Error("EditorLinter expects a valid TextEditor");const i=e.getBuffer(),s=Qt(()=>{this.emitter.emit("should-lint",!1)},50,{leading:!0});this.editor=e,this.emitter=new t.Emitter,this.subscriptions=new t.CompositeDisposable,this.subscriptions.add(this.editor.onDidDestroy(()=>this.dispose())),this.subscriptions.add(this.editor.onDidSave(s)),this.subscriptions.add(i.onDidReload(s)),this.subscriptions.add(function(e,i,s){let r=null;const n=e.observe(i,(function(t){r&&r.dispose(),r=s.call(this,t)}));return new t.Disposable((function(){n.dispose(),r&&r.dispose()}))}(atom.config,"linter.lintOnChangeInterval",t=>i.onDidChange(Qt(()=>{this.emitter.emit("should-lint",!0)},t))))}getEditor(){return this.editor}lint(t=!1){this.emitter.emit("should-lint",t)}onShouldLint(t){return this.emitter.on("should-lint",t)}onDidDestroy(t){return this.emitter.on("did-destroy",t)}dispose(){this.emitter.emit("did-destroy"),this.subscriptions.dispose(),this.emitter.dispose()}}class ie{constructor(){this.emitter=void 0,this.lintOnOpen=void 0,this.subscriptions=void 0,this.editorLinters=void 0,this.emitter=new t.Emitter,this.subscriptions=new t.CompositeDisposable,this.editorLinters=new Map,this.subscriptions.add(this.emitter),this.subscriptions.add(atom.config.observe("linter.lintOnOpen",t=>{this.lintOnOpen=t}))}activate(){this.subscriptions.add(atom.workspace.observeTextEditors(t=>{this.createFromTextEditor(t)}))}get(t){return this.editorLinters.get(t)}createFromTextEditor(t){let e=this.editorLinters.get(t);return e||(e=new ee(t),e.onDidDestroy(()=>{this.editorLinters.delete(t)}),this.editorLinters.set(t,e),this.emitter.emit("observe",e),this.lintOnOpen&&e.lint(),e)}hasSibling(t){const e=t.getEditor().getBuffer();return Array.from(this.editorLinters.keys()).some(t=>t.getBuffer()===e)}observe(t){return this.editorLinters.forEach(t),this.emitter.on("observe",t)}dispose(){for(const t of this.editorLinters.values())t.dispose();this.subscriptions.dispose()}}let se,re,ne,oe;function ae(t){let e;if(t&&"object"==typeof t&&"string"==typeof t.name)e=t.name;else{if("string"!=typeof t)throw new Error("Unknown object passed to formatItem()");e=t}return"  - "+e}function de(t,e){return t.name.localeCompare(e.name)}class le{constructor(){this.emitter=void 0,this.subscriptions=void 0,this.emitter=new t.Emitter,this.subscriptions=new t.CompositeDisposable,this.subscriptions.add(this.emitter),this.subscriptions.add(atom.commands.add("atom-workspace",{"linter:enable-linter":()=>this.enableLinter(),"linter:disable-linter":()=>this.disableLinter()})),this.subscriptions.add(atom.commands.add("atom-text-editor:not([mini])",{"linter:lint":()=>this.lint(),"linter:debug":()=>this.debug(),"linter:toggle-active-editor":()=>this.toggleActiveEditor()}))}lint(){this.emitter.emit("should-lint")}debug(){this.emitter.emit("should-debug")}enableLinter(){this.emitter.emit("should-toggle-linter","enable")}disableLinter(){this.emitter.emit("should-toggle-linter","disable")}toggleActiveEditor(){this.emitter.emit("should-toggle-active-editor")}showDebug(t,e,i){se||(se=require("../package.json"));const s=atom.workspace.getActiveTextEditor(),r=Ut(s),n=t.slice().sort(de),o=e.slice().sort(de),a=i.slice().sort(de),d=o.map(ae).join("\n"),l=n.map(ae).join("\n"),h=n.filter(t=>Ot(t,!1,r)).map(ae).join("\n"),c=r.map(ae).join("\n"),u=a.map(ae).join("\n"),p=atom.config.get("linter.ignoreGlob"),g=atom.config.get("core.excludeVcsIgnoredPaths"),f=atom.config.get("linter.disabledProviders").map(ae).join("\n"),m=$t(s.getPath(),p,g);atom.notifications.addInfo("Linter Debug Info",{detail:["Platform: "+process.platform,"Atom Version: "+atom.getVersion(),"Linter Version: "+se.version,"Opened file is ignored: "+(m?"Yes":"No"),"Matching Linter Providers: \n"+h,"Disabled Linter Providers: \n"+f,"Standard Linter Providers: \n"+l,"Indie Linter Providers: \n"+d,"UI Providers: \n"+u,"Ignore Glob: "+p,"VCS Ignored Paths are excluded: "+g,"Current File Scopes: \n"+c].join("\n"),dismissable:!0})}onShouldLint(t){return this.emitter.on("should-lint",t)}onShouldDebug(t){return this.emitter.on("should-debug",t)}onShouldToggleActiveEditor(t){return this.emitter.on("should-toggle-active-editor",t)}onShouldToggleLinter(t){return this.emitter.on("should-toggle-linter",t)}dispose(){this.subscriptions.dispose()}}class he{constructor(e,i){this.action=void 0,this.emitter=void 0,this.providers=void 0,this.subscriptions=void 0,this.disabledProviders=void 0,this.action=e,this.emitter=new t.Emitter,this.providers=i,this.subscriptions=new t.CompositeDisposable,this.subscriptions.add(this.emitter),this.subscriptions.add(atom.config.observe("linter.disabledProviders",t=>{this.disabledProviders=t}))}async getItems(){return"disable"===this.action?this.providers.filter(t=>!this.disabledProviders.includes(t)):this.disabledProviders}async process(t){if("disable"===this.action)this.disabledProviders.push(t),this.emitter.emit("did-disable",t);else{const e=this.disabledProviders.indexOf(t);-1!==e&&this.disabledProviders.splice(e,1)}atom.config.set("linter.disabledProviders",this.disabledProviders)}async show(){re||(re=require("atom-select-list"));const e=new re({items:await this.getItems(),emptyMessage:"No matches found",elementForItem:t=>{const e=document.createElement("li");return e.textContent=t,e},didConfirmSelection:t=>{this.process(t).catch(t=>console.error("[Linter] Unable to process toggle:",t)).then(()=>this.dispose())},didCancelSelection:()=>{this.dispose()},didConfirmEmptySelection:()=>{this.dispose()}}),i=atom.workspace.addModalPanel({item:e});e.focus(),this.subscriptions.add(new t.Disposable((function(){i.destroy()})))}onDidDispose(t){return this.emitter.on("did-dispose",t)}onDidDisable(t){return this.emitter.on("did-disable",t)}dispose(){this.emitter.emit("did-dispose"),this.subscriptions.dispose()}}class ce{constructor(){this.commands=void 0,this.registryUI=void 0,this.registryIndie=void 0,this.registryEditors=void 0,this.registryLinters=void 0,this.registryMessages=void 0,this.subscriptions=void 0,this.idleCallbacks=void 0,this.idleCallbacks=new Set,this.subscriptions=new t.CompositeDisposable,this.commands=new le,this.subscriptions.add(this.commands),this.commands.onShouldLint(()=>{this.registryEditorsInit();const t=this.registryEditors.get(atom.workspace.getActiveTextEditor());t&&t.lint()}),this.commands.onShouldToggleActiveEditor(()=>{const t=atom.workspace.getActiveTextEditor();this.registryEditorsInit();const e=this.registryEditors.get(t);e?e.dispose():t&&this.registryEditors.createFromTextEditor(t)}),this.commands.onShouldDebug(async()=>{this.registryUIInit(),this.registryIndieInit(),this.registryLintersInit(),this.commands.showDebug(this.registryLinters.getProviders(),this.registryIndie.getProviders(),this.registryUI.getProviders())}),this.commands.onShouldToggleLinter(t=>{this.registryLintersInit();const e=new he(t,Et(this.registryLinters.getProviders().map(t=>t.name)));e.onDidDispose(()=>{this.subscriptions.remove(e)}),e.onDidDisable(t=>{const e=this.registryLinters.getProviders().find(e=>e.name===t);e&&(this.registryMessagesInit(),this.registryMessages.deleteByLinter(e))}),e.show(),this.subscriptions.add(e)});const e=window.requestIdleCallback(function(){this.idleCallbacks.delete(e),this.subscriptions.add(atom.project.onDidChangePaths(()=>{this.commands.lint()}))}.bind(this));this.idleCallbacks.add(e);const i=window.requestIdleCallback(function(){this.idleCallbacks.delete(i),this.registryEditorsInit()}.bind(this));this.idleCallbacks.add(i)}dispose(){this.idleCallbacks.forEach(t=>window.cancelIdleCallback(t)),this.idleCallbacks.clear(),this.subscriptions.dispose()}registryEditorsInit(){this.registryEditors||(this.registryEditors=new ie,this.subscriptions.add(this.registryEditors),this.registryEditors.observe(t=>{t.onShouldLint(e=>{this.registryLintersInit(),this.registryLinters.lint({onChange:e,editor:t.getEditor()})}),t.onDidDestroy(()=>{this.registryMessagesInit(),this.registryEditors.hasSibling(t)||this.registryMessages.deleteByBuffer(t.getEditor().getBuffer())})}),this.registryEditors.activate())}registryLintersInit(){this.registryLinters||(this.registryLinters=new te,this.subscriptions.add(this.registryLinters),this.registryLinters.onDidUpdateMessages(({linter:t,messages:e,buffer:i})=>{this.registryMessagesInit(),this.registryMessages.set({linter:t,messages:e,buffer:i})}),this.registryLinters.onDidBeginLinting(({linter:t,filePath:e})=>{this.registryUIInit(),this.registryUI.didBeginLinting(t,e)}),this.registryLinters.onDidFinishLinting(({linter:t,filePath:e})=>{this.registryUIInit(),this.registryUI.didFinishLinting(t,e)}))}registryIndieInit(){this.registryIndie||(this.registryIndie=new Ft,this.subscriptions.add(this.registryIndie),this.registryIndie.observe(t=>{t.onDidDestroy(()=>{this.registryMessagesInit(),this.registryMessages.deleteByLinter(t)})}),this.registryIndie.onDidUpdate(({linter:t,messages:e})=>{this.registryMessagesInit(),this.registryMessages.set({linter:t,messages:e,buffer:null})}))}registryMessagesInit(){this.registryMessages||(this.registryMessages=new Zt,this.subscriptions.add(this.registryMessages),this.registryMessages.onDidUpdateMessages(t=>{this.registryUIInit(),this.registryUI.render(t)}))}registryUIInit(){this.registryUI||(this.registryUI=new Ct,this.subscriptions.add(this.registryUI))}addUI(t){this.registryUIInit(),this.registryUI.add(t),this.registryMessagesInit();const{messages:e}=this.registryMessages;e.length&&t.render({added:e,messages:e,removed:[]})}deleteUI(t){this.registryUIInit(),this.registryUI.delete(t)}addLinter(t){this.registryLintersInit(),this.registryLinters.addLinter(t)}deleteLinter(t){this.registryLintersInit(),this.registryLinters.deleteLinter(t),this.registryMessagesInit(),this.registryMessages.deleteByLinter(t)}addIndie(t){return this.registryIndieInit(),this.registryIndie.register(t,2)}}exports.activate=function(){oe=new t.CompositeDisposable,ne=new ce,oe.add(ne),oe.add(atom.packages.onDidActivateInitialPackages((function(){atom.inSpecMode()||require("atom-package-deps").install("linter",!0)})))},exports.consumeLinter=function(e){const i=[].concat(e);for(const t of i)ne.addLinter(t);return new t.Disposable(()=>{for(const t of i)ne.deleteLinter(t)})},exports.consumeUI=function(e){const i=[].concat(e);for(const t of i)ne.addUI(t);return new t.Disposable(()=>{for(const t of i)ne.deleteUI(t)})},exports.deactivate=function(){oe.dispose()},exports.provideIndie=function(){return t=>ne.addIndie(t)};
//# sourceMappingURL=index.js.map
